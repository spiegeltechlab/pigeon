var Pigeon=(()=>{var _=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var b=_(($e,F)=>{var w={strict:!0,getObjectId:t=>t.id||t._id||t.uuid||t.slug,getTimestamp:Date.now};function ie(t){Object.assign(w,t)}function se(t,e,n){if(n){let i=O(n);i&&(e=`[${i}]`)}return ae(t,e)}function re(t){return typeof t=="string"&&(t.indexOf("/")!==-1||t.indexOf("~")!==-1)?t.replace(/~/g,"~0").replace(/\//g,"~1"):t}function oe(t){return typeof t=="string"&&(t.indexOf("~1")!==-1||t.indexOf("~0")!==-1)?t.replace(/~1/g,"/").replace(/~0/g,"~"):t}function ce(t){return t.split("/").map(e=>oe(e))}function ae(t,e){return e=re(e),[t,e].filter(n=>n!=null).join("/").replace("//","/")}function d(t){return Array.isArray(t)?"array":t===null?"null":typeof t}function I(t){let e=d(t);return e==="number"||e==="null"||e==="boolean"||e=="string"}function fe(t){return d(t)==="array"&&t.every(e=>I(e))}function H(t){let e=d(t);if(e=="array"){let n=Array(t.length);for(let i=0;i<t.length;i++)n[i]=H(t[i]);return n}else if(e=="object"){if(t.toJSON)return t.toJSON();{let n={};for(let i in t)n[i]=H(t[i]);return n}}else if(I(t))return typeof t=="number"?isFinite(t)?t:null:t}function ue(t,e){if(I(t))return t===e;if(d(t)=="object")return O(t)===O(e);if(d(t)=="array")throw new Error("can't compare arrays of arrays")}function O(t){if(d(t)=="object"){let e=w.getObjectId(t);if(e!=null)return e;if(w.strict)throw new Error("couldn't find id for object",{cause:t});return D(v(t))}else return null}function le(t,e,n){let i={op:t,path:e};return Object.assign(i,n),i}function v(t){return d(t)=="array"?`[${t.map(v).join(",")}]`:d(t)=="object"?`{${Object.keys(t).sort().map(e=>`${JSON.stringify(e)}:${v(t[e])}`).join(",")}}`:JSON.stringify(t)}function D(t){return Math.abs([].reduce.call(t,(e,n,i,s)=>(e<<5)-e+s.charCodeAt(i),0))}function pe(t){return D(v(t))}F.exports={_path:se,_typeof:d,_isPrimitive:I,_isArrayOfPrimitives:fe,_clone:H,_entangled:ue,_objId:O,_op:le,_stable:v,_crc:pe,_decodePath:ce,_config:w,_configure:ie}});var W=_((Se,R)=>{var{_path:g,_typeof:m,_isPrimitive:L,_isArrayOfPrimitives:A,_clone:q,_entangled:he,_op:C,_config:ge}=b();function de(t,e){let n=m(t);if(n!==m(e))throw new Error("can't diff different types");if(L(t))return M(t,e);if(A(t))return k(t,e);if(n=="array")return K(t,e);if(n=="object")return P(t,e);throw new Error("unsupported type")}function M(t,e,n="/"){return t!==e?[C("replace",g(n),{value:e,_prev:t})]:[]}function k(t,e,n="/"){let i=!A(e)||t.length!==e.length;if(!i)for(let s=0;s<t.length;s++)i=i||t[s]!==e[s];return i?[C("replace",g(n),{value:e,_prev:t})]:[]}function K(t,e,n="/"){let i={},s={},c=[];for(let a=0;a<t.length;a++)for(let r=0;r<e.length;r++)r in s||a in i||(!ge.strict&&m(t[a])=="array"&&m(e[r])=="array"&&a==r||he(t[a],e[r]))&&(i[a]=r,s[r]=a);let o=[];for(let a=0,r=0;r<e.length||a<t.length;){if(r in e&&a in t&&s[r]==a){m(e[r])==="object"&&o.push(...P(t[a],e[r],g(n,a,e[r]))),r++,a++;continue}if(a<t.length&&!(a in i)){o.push(C("remove",g(n,a,t[a]),{_prev:t[a]})),a++;continue}if(r<e.length&&!(r in s)){let h=r+1 in t?g(n,r,e[r+1]):g(n,r),f=C("add",h,{value:e[r]});t.length>=e.length?c.unshift(f):c.push(f),r++;continue}if(r<e.length&&r in s){let u=g(n,s[r],t[s[r]]),h=g(n,r);h!=u&&(o.push({op:"move",from:u,path:h}),m(s[r])=="object"&&o.push(...P(t[s[r]],e[r],n))),a++,r++;continue}throw new Error("couldn't create diff")}return o.concat(c)}function P(t,e,n="/",i){let s=[],c=Object.keys(t),o=c.length,a=0;for(let h=0;h<o;h++){let f=c[h];if(!e.hasOwnProperty(f)){a++,s.push({op:"remove",path:g(n,f),_prev:q(t[f])});continue}if(t[f]===e[f])continue;let p=m(t[f]);L(t[f])?s.push(...M(t[f],e[f],g(n,f),i)):A(t[f])?s.push(...k(t[f],e[f],g(n,f),i)):p!==m(e[f])?s.push({op:"replace",path:g(n,f),value:q(e[f]),_prev:q(t[f])}):p==="array"?s.push(...K(t[f],e[f],g(n,f))):p==="object"&&s.push(...P(t[f],e[f],g(n,f),i))}let r=Object.keys(e),u=r.length;if(u>o-a)for(let h=0;h<u;h++){let f=r[h];t.hasOwnProperty(f)||s.push({op:"add",path:g(n,f),value:q(e[f])})}return s}R.exports=de});var N=_((Ee,z)=>{var{_typeof:me,_clone:j,_objId:G,_decodePath:ye}=b();function _e(t,e){e=j(e);let n=[],i=null;e:for(let[s,c]of e.entries()){let o=ye(c.path),a=o.shift(),r=o.pop(),u=t;for(let p of o){if(!u){n.push(c);continue e}let y=Y(p);y?u=u.find(ne=>G(ne)==y):u=u[p]}let h=Y(r);if(h){let p=u.findIndex(y=>G(y)==h);~p?r=p:n.push(c)}let f=me(u);if(c.op=="replace")u[r]=j(c.value);else if(c.op=="move"){i={};let p=[{op:"remove",path:c.from},{op:"add",path:c.path,value:i}];e.splice(s+1,0,...p)}else if(c.op=="remove"){if(f=="object")i&&(i.value=j(u[r])),delete u[r];else if(f=="array"){let p=u.splice(r,1);i&&([i.value]=p)}}else c.op=="add"&&(f=="object"?u[r]=j(c.value):f=="array"&&(i&&c.value===i?(u.splice(r,0,i.value),i=null):u.splice(r,0,j(c.value))))}return t}function Y(t){if(t===void 0)return;let e=t.match(/^\[(.+)\]$/);if(e)return e[1]}z.exports=_e});var $=_((Je,Q)=>{var{_clone:B,_objId:ve}=b();function be(t,e=[]){let n=B(t).reverse(),i=B(e).reverse();for(let o of n){if(o.op=="add"){o.op="remove";let a=ve(o.value);if(a){let r=o.path.split("/"),u=r[r.length-1];!u.startsWith("[")&&!u.endsWith("]")?(r[r.length-1]=`[${a}]`,o.path=r.join("/")):u.startsWith("[")&&u.endsWith("]")&&(r[r.length-1]=`[${a}]`,o.path=r.join("/"))}}else if(o.op=="remove"){o.op="add";let a=o.path.split("/"),r=a[a.length-1],u=r;r.startsWith("[")&&r.endsWith("]")&&(a[a.length-1]="0",o.path=a.join("/"),u=r.replace(/^\[|\]$/g,""));let f=i.find(p=>p.diff.some(y=>y?.op==="add"&&y.value.id===u))?.diff.filter(p=>p.op==="add"&&p.value.id===u);Array.isArray(f)&&f.length===1&&f[0]?.value&&(o._prev=f[0].value)}if("_prev"in o)var s=o._prev;if("value"in o)var c=o.value;s===void 0?delete o.value:o.value=s,c===void 0?delete o._prev:o._prev=c}return n}Q.exports=be});var x=_((Te,Z)=>{var je=W(),S=N(),we=$(),{_clone:E,_crc:Oe,_configure:Ie,_config:U}=b(),J=1e3,l=new WeakMap,V=X(),T=class t{constructor(){l.set(this,{history:[],stash:[],warning:null,changeIds:{}})}static from(e,n=V){let i=new t;return l.get(i).client_id=n,i=t.change(i,s=>Object.assign(s,e)),i}static _forge(e,n=V){let i=new t;return l.get(i).client_id=n,Object.assign(i,E(e)),i}static alias(e){console.warning("Feature is currently not supported correctly (since primitve array support)");let n=new t;return l.set(n,l.get(e)),Object.assign(n,e),n}static init(){return t.from({})}static clone(e,n=J){let i=t._forge(e);return l.get(i).history=l.get(e).history,l.get(i).changeIds=E(l.get(e).changeIds),t.pruneHistory(l.get(i),n),i}static pruneHistory(e,n){let i=e.history.length;if(i>n){let s=e.history.slice(0,i-n);for(let c of s)delete e.changeIds[c.change_id]}e.history=e.history.slice(-n)}static getChange(e,n){return{diff:je(e,n),client_id:l.get(e).client_id,timestamp_ms:U.getTimestamp(),seq:Ce(),change_id:X()}}static rewindChanges(e,n,i){let{history:s}=l.get(e);for(;!(s.length<=1);){let c=s[s.length-1];if(c.timestamp_ms>n||c.timestamp_ms==n&&c.client_id>i){let o=l.get(e).history.pop();S(e,we(o.diff,s)),delete l.get(e).changeIds[o.change_id],l.get(e).stash.push(o);continue}break}}static fastForwardChanges(e){let{stash:n,history:i}=l.get(e),s;for(;s=n.pop();)S(e,s.diff),l.get(e).changeIds[s.change_id]=1,i.push(s)}static applyChangeInPlace(e,n){return t.applyChange(e,n,!0)}static applyChange(e,n,i){l.get(e).warning=null;let s=i?e:t.clone(e);if(l.get(e).changeIds[n.change_id])return s;try{t.rewindChanges(s,n.timestamp_ms,n.client_id)}catch(a){l.get(s).warning="rewind failed: "+a}try{S(s,n.diff),l.get(s).changeIds[n.change_id]=1}catch(a){l.get(s).warning="patch failed: "+a}try{t.fastForwardChanges(s)}catch(a){l.get(s).warning="forward failed: "+a}let c=l.get(s).history,o=c.length;for(;o>1&&c[o-1].timestamp_ms>n.timestamp_ms;)o--;return c.splice(o,0,n),s}static change(e,n){let i=E(e);n(i);let s=t.getChange(e,i);return t.applyChange(e,s)}static getHistory(e){return l.get(e).history}static merge(e,n){let i=t.from({}),s=t.getHistory(e),c=t.getHistory(n),o=[];for(;s.length||c.length;)c.length?s.length?s[0].change_id===c[0].change_id?o.push(s.shift()&&c.shift()):s[0].timestamp_ms<c[0].timestamp_ms||s[0].timestamp_ms==c[0].timestamp_ms&&s[0].seq<c[0].seq?o.push(s.shift()):o.push(c.shift()):o.push(c.shift()):o.push(s.shift());for(let a of o)i=t.applyChange(i,a);return i}static getWarning(e){return l.get(e).warning}static getMissingDeps(e){return!1}static setHistoryLength(e){J=e}static setTimestamp(e){U.getTimestamp=e}static crc(e){return Oe(e)}static load(e,n=J){let{meta:i,data:s}=JSON.parse(e);t.pruneHistory(i,n);let c=t.from(s);return Object.assign(l.get(c),i),c}static save(e){let{client_id:n,...i}=l.get(e);return JSON.stringify({meta:i,data:e})}static configure(e){Ie(e)}};function X(){return Math.random().toString(36).substring(2)}var qe=0;function Ce(){return qe++}Z.exports=T});var We=_((De,te)=>{var Pe=W(),He=N(),Ae=$(),ee=x();te.exports=Object.assign(ee,{auto:ee,diff:Pe,patch:He,reverse:Ae})});return We();})();
