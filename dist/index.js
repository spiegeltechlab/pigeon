var Pigeon=(()=>{var M=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var D=(t,e)=>{var n={};for(var i in t)ne.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&M)for(var i of M(t))e.indexOf(i)<0&&ie.call(t,i)&&(n[i]=t[i]);return n};var v=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var b=v((Je,k)=>{var w={strict:!0,getObjectId:t=>t.id||t._id||t.uuid||t.slug,getTimestamp:Date.now};function re(t){Object.assign(w,t)}function se(t,e,n){if(n){let i=O(n);i&&(e="[".concat(i,"]"))}return ae(t,e)}function oe(t){return typeof t=="string"&&(t.indexOf("/")!==-1||t.indexOf("~")!==-1)?t.replace(/~/g,"~0").replace(/\//g,"~1"):t}function ce(t){return typeof t=="string"&&(t.indexOf("~1")!==-1||t.indexOf("~0")!==-1)?t.replace(/~1/g,"/").replace(/~0/g,"~"):t}function fe(t){return t.split("/").map(e=>ce(e))}function ae(t,e){return e=oe(e),[t,e].filter(n=>n!=null).join("/").replace("//","/")}function h(t){return Array.isArray(t)?"array":t===null?"null":typeof t}function I(t){let e=h(t);return e==="number"||e==="null"||e==="boolean"||e=="string"}function H(t){let e=h(t);if(e=="array"){let n=Array(t.length);for(let i=0;i<t.length;i++)n[i]=H(t[i]);return n}else if(e=="object"){if(t.toJSON)return t.toJSON();{let n={};for(let i in t)n[i]=H(t[i]);return n}}else if(I(t))return typeof t=="number"?isFinite(t)?t:null:t}function ue(t,e){if(I(t))return t===e;if(h(t)=="object")return O(t)===O(e);if(h(t)=="array")throw new Error("can't compare arrays of arrays")}function O(t){if(h(t)=="object"){let e=w.getObjectId(t);if(e!=null)return e;if(w.strict)throw new Error("couldn't find id for object",{cause:t});return F(m(t))}else return null}function le(t,e,n){let i={op:t,path:e};return Object.assign(i,n),i}function m(t){return h(t)=="array"?"[".concat(t.map(m).join(","),"]"):h(t)=="object"?"{".concat(Object.keys(t).sort().map(e=>"".concat(JSON.stringify(e),":").concat(m(t[e]))).join(","),"}"):JSON.stringify(t)}function F(t){return Math.abs([].reduce.call(t,(e,n,i,r)=>(e<<5)-e+r.charCodeAt(i),0))}function pe(t){return F(m(t))}k.exports={_path:se,_typeof:h,_isPrimitive:I,_clone:H,_entangled:ue,_objId:O,_op:le,_stable:m,_crc:pe,_decodePath:fe,_config:w,_configure:re}});var P=v((Ae,L)=>{var{_path:d,_typeof:y,_isPrimitive:K,_clone:q,_entangled:ge,_objId:Te,_op:N,_config:de}=b();function he(t,e){let n=y(t);if(n!==y(e))throw new Error("can't diff different types");if(n=="array")return G(t,e);if(n=="object")return C(t,e);if(K(t))return W(t,e);throw new Error("unsupported type")}function W(t,e,n="/"){return t!==e?[N("replace",d(n),{value:e,_prev:t})]:[]}function G(t,e,n="/"){let i={},r={},s=[];for(let c=0;c<t.length;c++)for(let o=0;o<e.length;o++)o in r||c in i||(!de.strict&&y(t[c])=="array"&&y(e[o])=="array"&&c==o||ge(t[c],e[o]))&&(i[c]=o,r[o]=c);let f=[];for(let c=0,o=0;o<e.length||c<t.length;){if(o in e&&c in t&&r[o]==c){y(e[o])==="object"&&f.push(...C(t[c],e[o],d(n,c,e[o]))),o++,c++;continue}if(c<t.length&&!(c in i)){f.push(N("remove",d(n,c,t[c]),{_prev:t[c]})),c++;continue}if(o<e.length&&!(o in r)){s.unshift(N("add",d(n,o,e[o+1]),{value:e[o]})),o++;continue}if(o<e.length&&o in r){let l=d(n,r[o],t[r[o]]),p=d(n,o);p!=l&&(f.push({op:"move",from:l,path:p}),y(r[o])=="object"&&f.push(...C(t[r[o]],e[o],n))),c++,o++;continue}throw new Error("couldn't create diff")}return f.concat(s)}function C(t,e,n="/",i){let r=[],s=Object.keys(t),f=s.length,c=0;for(let p=0;p<f;p++){let a=s[p];if(!e.hasOwnProperty(a)){c++,r.push({op:"remove",path:d(n,a),_prev:q(t[a])});continue}if(t[a]===e[a])continue;let g=y(t[a]);K(t[a])?r.push(...W(t[a],e[a],d(n,a),i)):g!==y(e[a])?r.push({op:"replace",path:d(n,a),value:q(e[a]),_prev:q(t[a])}):g==="array"?r.push(...G(t[a],e[a],d(n,a))):g==="object"&&r.push(...C(t[a],e[a],d(n,a),i))}let o=Object.keys(e),l=o.length;if(l>f-c)for(let p=0;p<l;p++){let a=o[p];t.hasOwnProperty(a)||r.push({op:"add",path:d(n,a),value:q(e[a])})}return r}L.exports=he});var S=v((Me,z)=>{var{_typeof:ye,_clone:_,_objId:R,_decodePath:ve}=b();function me(t,e){e=_(e);let n=[],i=null;e:for(let[r,s]of e.entries()){let f=ve(s.path),c=f.shift(),o=f.pop(),l=t;for(let g of f){if(!l){n.push(s);continue e}let j=Y(g);j?l=l.find(te=>R(te)==j):l=l[g]}let p=Y(o);if(p){let g=l.findIndex(j=>R(j)==p);~g?o=g:n.push(s)}let a=ye(l);if(s.op=="replace")l[o]=_(s.value);else if(s.op=="move"){i={};let g=[{op:"remove",path:s.from},{op:"add",path:s.path,value:i}];e.splice(r+1,0,...g)}else if(s.op=="remove"){if(a=="object")i&&(i.value=_(l[o])),delete l[o];else if(a=="array"){let g=l.splice(o,1);i&&([i.value]=g)}}else s.op=="add"&&(a=="object"?l[o]=_(s.value):a=="array"&&(i&&s.value===i?(l.splice(o,0,i.value),i=null):l.splice(o,0,_(s.value))))}return t}function Y(t){if(t===void 0)return;let e=t.match(/^\[(.+)\]$/);if(e)return e[1]}z.exports=me});var $=v((De,B)=>{var{_clone:be,_objId:_e}=b();function je(t){let e=be(t).reverse();for(let r of e){if(r.op=="add"){r.op="remove";let s=_e(r.value);s&&(r._index=r.path.split("/").pop(),r.path=r.path.replace(/\d+$/,"[".concat(s,"]")))}else r.op=="remove"&&(r.op="add");if("_prev"in r)var n=r._prev;if("value"in r)var i=r.value;n===void 0?delete r.value:r.value=n,i===void 0?delete r._prev:r._prev=i}return e}B.exports=je});var Z=v((Fe,X)=>{var we=P(),E=S(),Oe=$(),{_clone:J,_crc:qe,_configure:Ce,_config:Q}=b(),T=1e3,u=new WeakMap,U=V(),A=class t{constructor(){u.set(this,{history:[],stash:[],warning:null,gids:{}})}static from(e,n=U){let i=new t;return u.get(i).cid=n,i=t.change(i,r=>Object.assign(r,e)),i}static _forge(e,n=U){let i=new t;return u.get(i).cid=n,Object.assign(i,J(e)),i}static alias(e){let n=new t;return u.set(n,u.get(e)),Object.assign(n,e),n}static init(){return t.from({})}static clone(e,n=T){let i=t._forge(e);return u.get(i).history=u.get(e).history,u.get(i).gids=J(u.get(e).gids),t.pruneHistory(u.get(i),n),i}static pruneHistory(e,n){let i=e.history.length;if(i>n){let r=e.history.slice(0,i-n);for(let s of r)delete e.gids[s.gid]}e.history=e.history.slice(-n)}static getChanges(e,n){return{diff:we(e,n),cid:u.get(e).cid,ts:Q.getTimestamp(),seq:Ie(),gid:V()}}static rewindChanges(e,n,i){let{history:r}=u.get(e);for(;!(r.length<=1);){let s=r[r.length-1];if(s.ts>n||s.ts==n&&s.cid>i){let f=u.get(e).history.pop();E(e,Oe(f.diff)),delete u.get(e).gids[f.gid],u.get(e).stash.push(f);continue}break}}static fastForwardChanges(e){let{stash:n,history:i}=u.get(e),r;for(;r=n.pop();)E(e,r.diff),u.get(e).gids[r.gid]=1,i.push(r)}static applyChangesInPlace(e,n){return t.applyChanges(e,n,!0)}static applyChanges(e,n,i){u.get(e).warning=null;let r=i?e:t.clone(e);if(u.get(e).gids[n.gid])return r;try{t.rewindChanges(r,n.ts,n.cid)}catch(c){u.get(r).warning="rewind failed: "+c}try{E(r,n.diff),u.get(r).gids[n.gid]=1}catch(c){u.get(r).warning="patch failed: "+c}try{t.fastForwardChanges(r)}catch(c){u.get(r).warning="forward failed: "+c}let s=u.get(r).history,f=s.length;for(;f>1&&s[f-1].ts>n.ts;)f--;return s.splice(f,0,n),r}static change(e,n){let i=J(e);n(i);let r=t.getChanges(e,i);return t.applyChanges(e,r)}static getHistory(e){return u.get(e).history}static merge(e,n){let i=t.from({}),r=t.getHistory(e),s=t.getHistory(n),f=[];for(;r.length||s.length;)s.length?r.length?r[0].gid===s[0].gid?f.push(r.shift()&&s.shift()):r[0].ts<s[0].ts||r[0].ts==s[0].ts&&r[0].seq<s[0].seq?f.push(r.shift()):f.push(s.shift()):f.push(s.shift()):f.push(r.shift());for(let c of f)i=t.applyChanges(i,c);return i}static getWarning(e){return u.get(e).warning}static getMissingDeps(e){return!1}static setHistoryLength(e){T=e}static setTimestamp(e){Q.getTimestamp=e}static crc(e){return qe(e)}static load(e,n=T){let{meta:i,data:r}=JSON.parse(e);t.pruneHistory(i,n);let s=t.from(r);return Object.assign(u.get(s),i),s}static save(e){let r=u.get(e),{cid:n}=r,i=D(r,["cid"]);return JSON.stringify({meta:i,data:e})}static configure(e){Ce(e)}};function V(){return Math.random().toString(36).substring(2)}var He=0;function Ie(){return He++}X.exports=A});var $e=v((Ke,ee)=>{var Ne=P(),Pe=S(),Se=$(),x=Z();ee.exports=Object.assign(x,{auto:x,diff:Ne,patch:Pe,reverse:Se})});return $e();})();
